<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VLC‚ÄëLike Playlist Player</title>

  <!-- Video.js CSS -->
  <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />

  <style>
    body { font-family: Arial, sans-serif; background: #121212; color: #fff; text-align: center; padding: 40px; margin: 0; }
    .container { max-width: 900px; margin: auto; }
    .input-area { margin: 20px 0; }
    input { width: 70%; padding: 12px; font-size: 16px; border: none; border-radius: 4px; }
    button {
      padding: 6px 12px; font-size: 14px;
      margin: 3px; border: none; border-radius: 4px;
      cursor: pointer; background: #ff5722; color: white; transition: 0.2s;
    }
    button:hover { background: #e64a19; }
    ul.playlist { list-style: none; padding: 0; margin-top: 15px; }
    ul.playlist li {
      padding: 8px; background: #1e1e1e; margin: 4px 0;
      border-radius: 4px; display:flex; justify-content:space-between; align-items:center;
      word-break: break-all; cursor: pointer;
    }
    ul.playlist li.active { background: #ff5722; }
    .controls-extra, .playlist-controls { margin-top: 15px; }
    .li-text { flex: 1; text-align:left; cursor:pointer; padding-right:10px;}
    .mini-btn { font-size:11px; background:#00897b; }
    .mini-btn:hover { background:#00695c; }
  </style>
</head>
<body>

  <div class="container">
    <h1>üé¨ VLC‚ÄëLike Video Player with Playlist</h1>

    <div class="input-area">
      <input type="text" id="videoUrl" placeholder="Paste .mp4 or .m3u8 link" />
      <button id="addBtn">‚ûï Add</button>
      <button id="clearBtn">üóë Clear</button>
    </div>

    <!-- Main Player -->
    <video
      id="myPlayer"
      class="video-js vjs-default-skin"
      controls preload="auto"
      width="800" height="450"
      data-setup='{}'>
        <source src="" type="video/mp4" />
    </video>

    <!-- VLC Extras -->
    <div class="controls-extra">
      <button onclick="setSpeed(0.5)">0.5x</button>
      <button onclick="setSpeed(1)">1x</button>
      <button onclick="setSpeed(1.5)">1.5x</button>
      <button onclick="setSpeed(2)">2x</button>
      <button onclick="snapshot()">üì∏ Snapshot</button>
      <button onclick="frameStep()">‚è≠ Frame Step</button>
    </div>

    <!-- Playlist Controls -->
    <div class="playlist-controls">
      <button onclick="prevVideo()">‚èÆ Prev</button>
      <button onclick="nextVideo()">‚è≠ Next</button>
    </div>

    <!-- Playlist Display -->
    <ul id="playlist" class="playlist"></ul>

    <canvas id="snapshotCanvas" style="display:none;"></canvas>
  </div>

  <!-- Libraries -->
  <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-contrib-hls@5.15.0/dist/videojs-contrib-hls.min.js"></script>

  <script>
    const player = videojs('myPlayer');
    const addBtn    = document.getElementById('addBtn');
    const clearBtn  = document.getElementById('clearBtn');
    const urlInput  = document.getElementById('videoUrl');
    const playlistEl= document.getElementById('playlist');
    const canvas    = document.getElementById('snapshotCanvas');
    const ctx       = canvas.getContext('2d');

    let playlist    = JSON.parse(localStorage.getItem("playlist")) || [];
    let currentIndex= parseInt(localStorage.getItem("currentIndex") || "-1");

    function renderPlaylist() {
      playlistEl.innerHTML = "";
      playlist.forEach((url, i) => {
        const li = document.createElement("li");
        if (i === currentIndex) li.classList.add("active");

        // text clickable for selecting
        const span = document.createElement("span");
        span.className="li-text";
        span.textContent=url;
        span.onclick = () => playVideo(i);

        // standalone button
        const openBtn = document.createElement("button");
        openBtn.className="mini-btn";
        openBtn.textContent="üîó Open";
        openBtn.onclick=(e)=>{
          e.stopPropagation();
          window.open('player.html?src='+encodeURIComponent(url), '_blank');
        };

        li.appendChild(span);
        li.appendChild(openBtn);
        playlistEl.appendChild(li);
      });
      localStorage.setItem("playlist", JSON.stringify(playlist));
    }

    function playVideo(index) {
      if (index < 0 || index >= playlist.length) return;
      currentIndex = index;
      localStorage.setItem("currentIndex", currentIndex);

      let url  = playlist[index];
      let type = url.endsWith('.m3u8') ? 'application/x-mpegURL' : 'video/mp4';
      player.src({ src: url, type });
      player.play();
      renderPlaylist();
    }

    addBtn.onclick = () => {
      const url = urlInput.value.trim(); if (!url) return alert("Give me a URL!");
      playlist.push(url);
      if (currentIndex === -1) playVideo(0);
      renderPlaylist();
      urlInput.value="";
    };

    clearBtn.onclick = () => {
      playlist=[]; currentIndex=-1;
      localStorage.removeItem("playlist");
      localStorage.removeItem("currentIndex");
      renderPlaylist();
      player.src({src:""});
    };

    function prevVideo(){ playVideo(currentIndex-1); }
    function nextVideo(){ playVideo(currentIndex+1); }

    player.on('ended',()=>{ if (currentIndex<playlist.length-1) playVideo(currentIndex+1); });

    function setSpeed(x){ player.playbackRate(x); }
    function snapshot(){
      const videoEl=player.el().querySelector('video');
      canvas.width=videoEl.videoWidth; canvas.height=videoEl.videoHeight;
      ctx.drawImage(videoEl,0,0,canvas.width,canvas.height);
      const imgURL=canvas.toDataURL();
      const win=window.open(''); win.document.write(`<img src="${imgURL}"/>`);
    }
    function frameStep(){ player.pause(); player.currentTime(player.currentTime()+1/25); }

    // init
    renderPlaylist();
    
    if(currentIndex>=0 && currentIndex<playlist.length) playVideo(currentIndex);
  </script>
</body>
</html>
